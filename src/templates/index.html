{% extends 'base.html' %}

{% block title %}Home - Campus Resource Hub{% endblock %}

{% block scripts_head %}
<!-- Anime.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-content">
        <h1 class="hero-title">Find Campus Resources</h1>
        <p class="hero-subtitle">Search and reserve study rooms, equipment, event spaces, and more.</p>

        <!-- Search Bar -->
        <div class="search-container">
            <form action="{{ url_for('resource.index') }}" method="GET" class="search-form">
                <svg class="search-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <input
                    type="text"
                    name="q"
                    class="search-input"
                    placeholder="Search for resources, rooms, equipment..."
                    required
                />
                <button type="submit" class="search-button">Search</button>
            </form>
        </div>
    </div>
</section>

<!-- Quick Filters -->
<section class="filters-section">
    <div class="filters-container">
        <a href="{{ url_for('resource.index') }}" class="filter-chip">All Resources</a>
        <a href="#" class="filter-chip" id="available-now-chip">Available Now</a>
        <a href="{{ url_for('resource.index', category=1) }}" class="filter-chip">Study Spaces</a>
        <a href="{{ url_for('resource.index', category=2) }}" class="filter-chip">Equipment</a>
        <a href="{{ url_for('resource.index', category=4) }}" class="filter-chip">Event Spaces</a>
    </div>
</section>

<script>
// Handle "Available Now" click with current date/time
document.getElementById('available-now-chip').addEventListener('click', function(e) {
    e.preventDefault();
    const now = new Date();
    const date = now.toISOString().split('T')[0]; // YYYY-MM-DD
    const time = now.toTimeString().split(' ')[0].substring(0, 5); // HH:MM
    window.location.href = "{{ url_for('resource.index') }}" + "?availability_date=" + date + "&availability_time=" + time;
});
</script>

<!-- Resource Categories -->
<section class="categories-section">
    <h2 class="section-title">Browse by Category</h2>
    <div class="categories-carousel">
        <a href="{{ url_for('resource.index', category=1) }}" class="category-box" data-category="study-rooms">
            <div class="category-content">
                <div class="category-icon">
                    <img src="{{ url_for('static', filename='images/icons/Study_Room_Icon_Light.png') }}" alt="Study Rooms" class="icon-light">
                    <img src="{{ url_for('static', filename='images/icons/Study_Room_Icon_Dark.png') }}" alt="Study Rooms" class="icon-dark">
                </div>
                <h3 class="category-name">Study Rooms</h3>
                <div class="category-details">
                    <p class="category-description">Reserve quiet spaces for individual or group study sessions</p>
                    <div class="category-count">{{ category_availability.get(1, 0) }} available</div>
                </div>
            </div>
        </a>

        <a href="{{ url_for('resource.index', category=2) }}" class="category-box" data-category="av-equipment">
            <div class="category-content">
                <div class="category-icon">
                    <img src="{{ url_for('static', filename='images/icons/AV_Equip_Light.png') }}" alt="AV Equipment" class="icon-light">
                    <img src="{{ url_for('static', filename='images/icons/AV_Equip_Dark.png') }}" alt="AV Equipment" class="icon-dark">
                </div>
                <h3 class="category-name">AV Equipment</h3>
                <div class="category-details">
                    <p class="category-description">Borrow projectors, cameras, and audio-visual equipment</p>
                    <div class="category-count">{{ category_availability.get(2, 0) }} available</div>
                </div>
            </div>
        </a>

        <a href="{{ url_for('resource.index', category=3) }}" class="category-box" data-category="lab-instruments">
            <div class="category-content">
                <div class="category-icon">
                    <img src="{{ url_for('static', filename='images/icons/Lab_Light.png') }}" alt="Lab Instruments" class="icon-light">
                    <img src="{{ url_for('static', filename='images/icons/Lab_Dark.png') }}" alt="Lab Instruments" class="icon-dark">
                </div>
                <h3 class="category-name">Lab Instruments</h3>
                <div class="category-details">
                    <p class="category-description">Book specialized laboratory equipment and instruments</p>
                    <div class="category-count">{{ category_availability.get(3, 0) }} available</div>
                </div>
            </div>
        </a>

        <a href="{{ url_for('resource.index', category=4) }}" class="category-box" data-category="event-spaces">
            <div class="category-content">
                <div class="category-icon">
                    <img src="{{ url_for('static', filename='images/icons/Event_Light.png') }}" alt="Event Spaces" class="icon-light">
                    <img src="{{ url_for('static', filename='images/icons/Event_Dark.png') }}" alt="Event Spaces" class="icon-dark">
                </div>
                <h3 class="category-name">Event Spaces</h3>
                <div class="category-details">
                    <p class="category-description">Book venues for events, meetings, and presentations</p>
                    <div class="category-count">{{ category_availability.get(4, 0) }} available</div>
                </div>
            </div>
        </a>

        <a href="{{ url_for('resource.index', category=7) }}" class="category-box" data-category="computer-labs">
            <div class="category-content">
                <div class="category-icon">
                    <img src="{{ url_for('static', filename='images/icons/Computer_light.png') }}" alt="Computer Labs" class="icon-light">
                    <img src="{{ url_for('static', filename='images/icons/Computer_Dark.png') }}" alt="Computer Labs" class="icon-dark">
                </div>
                <h3 class="category-name">Computer Labs</h3>
                <div class="category-details">
                    <p class="category-description">Access computer labs with specialized software</p>
                    <div class="category-count">{{ category_availability.get(7, 0) }} available</div>
                </div>
            </div>
        </a>
    </div>
</section>

<!-- Featured Resources -->
<section class="featured-section">
    <h2 class="section-title">Featured Resources</h2>
    <div class="resources-grid">
        {% if featured_resources %}
            {% for resource in featured_resources %}
                {% set icon_map = {
                    'Study Rooms': 'Study_Room_Icon',
                    'AV Equipment': 'AV_Equip',
                    'Lab Instruments': 'Lab',
                    'Event Spaces': 'Event',
                    'Computer Labs': 'Computer'
                } %}
                {% set icon_name = icon_map.get(resource.category_name, 'Study_Room_Icon') %}
                <a href="{{ url_for('resource.detail', resource_id=resource.resource_id) }}" class="resource-card">
                    <div class="resource-image" style="background: linear-gradient(135deg, rgba(153, 9, 221, 0.1), rgba(134, 70, 238, 0.1));">
                        {% if resource.primary_image %}
                            <img src="{{ url_for('static', filename='uploads/' + resource.primary_image) }}" alt="{{ resource.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                        {% endif %}
                    </div>
                    <div class="resource-info">
                        <h3 class="resource-title">{{ resource.title }}</h3>
                        <p class="resource-category">
                            <img src="{{ url_for('static', filename='images/icons/' + icon_name + '_Light.png') }}" alt="" class="icon-light category-inline-icon">
                            <img src="{{ url_for('static', filename='images/icons/' + icon_name + '_Dark.png') }}" alt="" class="icon-dark category-inline-icon">
                            {{ resource.category_name }}
                        </p>
                        <p class="resource-description">{{ resource.description[:80] }}{% if resource.description|length > 80 %}...{% endif %}</p>
                        <div class="resource-meta">
                            <span class="resource-location">üìç {{ resource.location }}</span>
                            {% if resource.avg_rating and resource.review_count > 0 %}
                                <span class="resource-rating">‚≠ê {{ "%.1f"|format(resource.avg_rating) }} ({{ resource.review_count }} reviews)</span>
                            {% elif resource.capacity %}
                                <span class="resource-capacity">üë• {{ resource.capacity }} people</span>
                            {% endif %}
                        </div>
                        <button class="resource-book-btn">Book Now</button>
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <p>No featured resources available at the moment.</p>
        {% endif %}
    </div>
</section>

<!-- Footer -->
<footer class="footer">
    <div class="footer-container">
        <div class="footer-content">
            <p>&copy; 2025 Campus Resource Hub - Team 13</p>
            <p class="footer-subtitle">AI Driven Development (AiDD) 2025 Capstone Project<br>Kelley School of Business - Indiana University</p>
        </div>
    </div>
</footer>
{% endblock %}
